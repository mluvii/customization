<html>
<head>
 <style type="text/css">
  #collapse{
   background-color: #f00;
   width: 100px;
   height: 20px;
   position: absolute;
   top: 0;
   left: 0;
   cursor: pointer;
  }
  
  
  #open{
   background-color: #0f0;
   width: 100px;
   height: 20px;
   position: absolute;
   top: 25px;
   left: 0;
   cursor: pointer;
  }
  
  #ci{
   position: absolute;
   top: 50px;
   left:0;
  }
  </style>
</head>
<body>
 
 <div id="ci"></div>
 <div id="collapse">Collapse</div> 
 <div id="open">Open</div> 
 <script>
        function ciLoadDone() {
         console.log("CI Loaded");
         document.getElementById("ci").innerHTML ="CI loaded";
         Microsoft.CIFramework.getEnvironment().then(function(response){
           console.log("getEnvironment response: ", response); 
           }, function(error){
           console.log("getEnvironment Error: ", error); 
           });
        }
  
       (function(){
         let open = document.getElementById("open");
         open.addEventListener("click", function(){
           console.log("OpenCLicked");
           Microsoft.CIFramework.setMode(1).then(function(response){
           console.log("Open response: ", response); 
            return Promise.resolve();
           }, function(error){
           console.log("Open Error: ", error); 
            return Promise.resolve();
           });
         });
        
        let collapse = document.getElementById("collapse");
         collapse.addEventListener("click", function(){
          console.log("Collapse CLicked");
           Microsoft.CIFramework.setMode(0).then(function(response){
           console.log("Collapse response: ", response); 
            return Promise.resolve();
           }, function(error){
           console.log("Collapse Error: ", error); 
            return Promise.resolve();
           });
         });
        
        handlerFunction = function(eventData) {
console.log(eventData)
return Promise.resolve();
}

Microsoft.CIFramework.addHandler("onmodechanged", handlerFunction);
        
        console.log("Listeners added");
       })();
    </script>
      
<script type="text/javascript" src="https://mluvii.crm4.dynamics.com/webresources/Widget/msdyn_ciLibrary.js" onload="ciLoadDone();" data-crmurl="@Context.Request.Query["base"]" data-cifid="CIFMainLibrary"></script> 

</body>
</html>
